package dao.Impl;

import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;

import dao.LuongNhanVienDao;
import jakarta.persistence.EntityManager;
import jakarta.persistence.EntityManagerFactory;
import jakarta.persistence.Persistence;

public class LuongNhanVienDaoImpl extends UnicastRemoteObject implements LuongNhanVienDao{

	/**
	 * 
	 */
	private static final long serialVersionUID = 3091377733054205270L;
	private EntityManagerFactory emf;

	protected LuongNhanVienDaoImpl() throws RemoteException {
		// Khởi tạo EntityManagerFactory
		emf = Persistence.createEntityManagerFactory("jpa-mssql");
	}

	public int getMaxSalaryId() {
		EntityManager em = emf.createEntityManager(); // Mở EntityManager
		try {
			// Sử dụng JPQL để truy vấn mã lương lớn nhất
			Integer maxSalaryId = em.createQuery("SELECT MAX(l.id) FROM LuongNhanVien l", Integer.class)
					.getSingleResult(); // Thực hiện truy vấn và lấy kết quả

			// Nếu không có kết quả, trả về 0
			if (maxSalaryId == null) {
				return 0;
			}

			return maxSalaryId;
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			em.close(); // Đóng EntityManager sau khi sử dụng
		}
		return 0;
	}
	

}
